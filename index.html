<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Fragebogen (15 Fragen, Mix aus Tiermetaphern)</title>
  <!-- Chart.js per CDN laden (Internetverbindung nötig) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0 auto;
      max-width: 900px;
      background: #f7f9fc;
      padding: 20px;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #1a73e8;
      margin-bottom: 5px;
    }
    p.beschreibung {
      text-align: center;
      margin-top: 0;
      font-size: 0.95em;
      color: #555;
    }
    .frage-box {
      background: #fff;
      margin: 20px 0;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .frage-box h2 {
      font-size: 1.1em;
      margin-top: 0;
    }
    .skala-antwort {
      margin-left: 20px;
      margin-top: 5px;
    }
    .skala-antwort label {
      display: inline-block;
      margin-right: 10px;
      cursor: pointer;
    }
    button {
      display: block;
      margin: 20px auto;
      padding: 12px 20px;
      background-color: #4caf50;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    #ergebnis {
      background: #fff;
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    #ergebnis h2 {
      margin-top: 0;
    }
    .tier-block {
      margin: 10px 0;
      padding: 10px;
      border-radius: 6px;
      background: #f0f0f0;
    }
    .tier-block h3 {
      margin-top: 0;
    }
    .tier-name {
      color: #333;
      font-size: 1.05em;
      font-weight: bold;
    }
    /* Canvas für das Tortendiagramm */
    #chart {
      display: block;
      max-width: 600px;
      margin: 20px auto;
    }
    /* Ergebnis-Erklärung */
    .ergebnis-erklaerung {
      margin-top: 20px;
      font-size: 0.95em;
      color: #555;
    }
  </style>
</head>
<body>

<h1>Dein Fragebogen</h1>
<p class="beschreibung">
  Wähle für jede Aussage eine Zahl von 0 bis 4,<br>
  wobei 0 gar nicht zutrifft und 4 völlig zutrifft.
</p>

<form id="fragebogen"></form>
<button form="fragebogen" type="submit">Auswerten</button>

<div id="ergebnis"></div>
<canvas id="chart"></canvas>

<script>
// =====================================================
// 1) FRAGEN (15 Stück, inkl. Kombi in Frage 14 und Entwicklungsfeld in Frage 15)
// =====================================================
var questions = [
  {
    frage: "Frage 1: Was beschreibt deine bevorzugte Arbeitsweise am besten?",
    answers: {
      A: { code: "S1", text: "Ich übernehme gerne Verantwortung, koordiniere Aufgaben und habe stets den Gesamtüberblick." },
      B: { code: "S2", text: "Ich arbeite strukturiert, nutze etablierte Methoden und gehe Schritt für Schritt vor." },
      C: { code: "R1", text: "Ich bin robust und ausdauernd, bleibe auch in schwierigen Situationen standhaft." },
      D: { code: "R2", text: "Ich agiere flexibel und elegant, reagiere spontan auf neue Entwicklungen." }
    }
  },
  {
    frage: "Frage 2: Wie gehst du mit Konflikten um?",
    answers: {
      A: { code: "S3", text: "Ich suche aktiv den Austausch, bevorzuge kooperative Lösungen und fördere neue Ideen." },
      B: { code: "S4", text: "Ich passe mich an und versuche, Auseinandersetzungen zu entschärfen, bevor sie eskalieren." },
      C: { code: "R3", text: "Ich bin bereit, provokant und unkonventionell vorzugehen, um Konflikte aufzubrechen." },
      D: { code: "R4", text: "Ich bleibe ruhig, schaffe Stabilität und vermittle zwischen den Parteien." }
    }
  },
  {
    frage: "Frage 3: Was motiviert dich am meisten?",
    answers: {
      A: { code: "S5", text: "Große Herausforderungen, bei denen ich Kraft und Ausdauer beweisen kann." },
      B: { code: "S6", text: "Eine visionäre, idealistische Einstellung – ich lasse mich von großen Zielen inspirieren." },
      C: { code: "R5", text: "Strategische Lösungen finden, Chancen nutzen und dabei clever vorgehen." },
      D: { code: "R6", text: "Schnell zupacken, dynamisch sein und jede Gelegenheit sofort nutzen." }
    }
  },
  {
    frage: "Frage 4: Wie reagierst du auf Veränderungen?",
    answers: {
      A: { code: "S7", text: "Ich bleibe stabil, kann mich aber schnell neuen Bedingungen anpassen." },
      B: { code: "S8", text: "Ich analysiere Veränderungen gründlich und versuche, kluge Entscheidungen zu treffen." },
      C: { code: "R7", text: "Ich gehe eher vorsichtig und schrittweise vor, brauche Zeit für Umstellungen." },
      D: { code: "R8", text: "Ich bin mutig und übernehme Verantwortung, sobald sich eine Chance zeigt." }
    }
  },
  {
    frage: "Frage 5: Welche Aspekte sind dir in deiner Arbeit wichtig?",
    answers: {
      A: { code: "S9", text: "Besonnene Entscheidungen: Ich möchte nichts überstürzen." },
      B: { code: "S10", text: "Strategie und Innovation: Ich nutze gern jede Möglichkeit, kreativ vorzugehen." },
      C: { code: "R11", text: "Manchmal setze ich provokante Akzente, um festgefahrene Denkweisen aufzubrechen." },
      D: { code: "R12", text: "Effizienz und Zuverlässigkeit: Ich arbeite konsequent und konstruktiv am Gesamterfolg." }
    }
  },
  {
    frage: "Frage 6: Wie triffst du Entscheidungen?",
    answers: {
      A: { code: "S11", text: "Ich kläre erst alle Fragen im Team und gehe kommunikativ vor." },
      B: { code: "S12", text: "Ich bin loyal und setze auf Bewährtes, bevor ich ein Risiko eingehe." },
      C: { code: "R9", text: "Ich entscheide blitzschnell und entschlossen, oft ohne lange zu zögern." },
      D: { code: "R10", text: "Ich bin neugierig, spontan und lasse mich auch vom Bauchgefühl leiten." }
    }
  },
  {
    frage: "Frage 7: Wie wichtig ist dir Unabhängigkeit?",
    answers: {
      A: { code: "S13", text: "Sehr wichtig: Ich vereine vielseitige Fähigkeiten und arbeite gerne eigenständig und kreativ." },
      B: { code: "S14", text: "Ich lege Wert auf Durchsetzungsfähigkeit und unabhängiges Handeln." },
      C: { code: "R15", text: "Teamgeist und gemeinsamer Erfolg sind für mich entscheidend." },
      D: { code: "R16", text: "Eine gute Kommunikation stärkt den Zusammenhalt – ich priorisiere das Miteinander." }
    }
  },
  {
    frage: "Frage 8: Wie gehst du mit Verantwortung um?",
    answers: {
      A: { code: "S15", text: "Ich übernehme gerne führende Rollen und motiviere andere." },
      B: { code: "S16", text: "Ich bin zuverlässig, stehe zu meinen Aufgaben und halte meine Zusagen ein." },
      C: { code: "R13", text: "Ich setze Verantwortung strategisch ein, um Ziele zu erreichen." },
      D: { code: "R14", text: "Ich verknüpfe Verantwortung mit neuen Ideen und innovativen Konzepten." }
    }
  },
  {
    frage: "Frage 9: Wie gehst du mit Kritik um?",
    answers: {
      A: { code: "S17", text: "Ich bin offen, reflektiere mein Handeln und verbessere mich kontinuierlich." },
      B: { code: "S18", text: "Ich bleibe entschlossen bei meinem Weg, lasse mich nicht so leicht beirren." },
      C: { code: "R19", text: "Ich nehme mir Zeit für gründliche Selbstreflexion, um daraus zu lernen." },
      D: { code: "R20", text: "Ich bleibe stabil, nutze konstruktives Feedback als Chance zur Weiterentwicklung." }
    }
  },
  {
    frage: "Frage 10: Welche Rolle nimmst du im Team ein?",
    answers: {
      A: { code: "S19", text: "Ich zeige Führungsstärke, bin mutig und übernehme Verantwortung." },
      B: { code: "S20", text: "Ich kümmere mich um Details, arbeite sorgfältig und unterstütze zuverlässig." },
      C: { code: "R21", text: "Ich agiere visionär und bringe frische Impulse von außen ein." },
      D: { code: "R22", text: "Ich bin kraftvoll und setze meine Energie entschlossen ein, Herausforderungen offensiv anzugehen." }
    }
  },
  {
    frage: "Frage 11: Wie planst du langfristig?",
    answers: {
      A: { code: "S21", text: "Mit viel Energie und Enthusiasmus, immer auf der Suche nach neuen Chancen." },
      B: { code: "S22", text: "Clever und pragmatisch: Ich passe meine Strategie flexibel den Umständen an." },
      C: { code: "R17", text: "Ich wahre den Überblick, formuliere klare Visionen und setze sie strategisch um." },
      D: { code: "R18", text: "Ich bleibe besonnen und überlegt, lasse mich selbst durch Stress kaum aus der Ruhe bringen." }
    }
  },
  {
    frage: "Frage 12: Wie bewältigst du stressige Situationen?",
    answers: {
      A: { code: "S23", text: "Ich strahle Ruhe und Struktur aus, bleibe gelassen selbst unter Druck." },
      B: { code: "S24", text: "Ich passe mich an, finde kreative Wege, selbst wenn es turbulent wird." },
      C: { code: "R25", text: "Ich arbeite systematisch und detailliert, um Fehler und Stress zu minimieren." },
      D: { code: "R26", text: "Ich setze mir klare Ziele und bleibe trotz Druck fokussiert auf Höchstleistung." }
    }
  },
  {
    frage: "Frage 13: Welche besondere Stärke bringst du in den Beruf mit?",
    answers: {
      A: { code: "S25", text: "Ich bin engagiert, innovativ und unterstütze das Team verlässlich." },
      B: { code: "S26", text: "Ich bin robust, ausdauernd und scheue mich nicht vor großen Herausforderungen." },
      C: { code: "R23", text: "Ich bin flexibel, reagiere schnell und gehe offen auf Veränderungen zu." },
      D: { code: "R24", text: "Ich bin kooperativ, kreativ und bringe Ideen ein, die das Team voranbringen." }
    }
  },
  {
    frage: "Frage 14: Welche Stärken beschreiben dich am besten?",
    answers: {
      A: { code: "C1", text: "Fleiß, Flexibilität, Eleganz, visionäre Ansätze (vereint mehrere Eigenschaften)." },
      B: { code: "C2", text: "Robust, unabhängig, zupackend, meistert große Herausforderungen." },
      C: { code: "C3", text: "Gelassen, bedächtig, weise, strategisch – oft mit ruhiger Energie." },
      D: { code: "C4", text: "Manchmal provokant, loyal, spontan und ideenreich in neuen Situationen." }
    }
  },
  {
    frage: "Frage 15: In welchem Bereich erkennst du für dich persönlich ein Entwicklungsfeld?",
    answers: {
      A: { code: "C1", text: "Ich nehme mir vor, Kontrolle auch mal abzugeben und nicht alles perfekt machen zu wollen." },
      B: { code: "C2", text: "Ich möchte lernen, mit Impulsen bewusster umzugehen und Geduld zu entwickeln." },
      C: { code: "C3", text: "Ich arbeite daran, Entscheidungen mutiger zu treffen und nicht zu lange zu zögern." },
      D: { code: "C4", text: "Ich versuche, meine Spontanität zu strukturieren und emotionalen Ausbrüchen vorzubeugen." }
    }
  }
];

// =====================================================
// 2) CODE -> TIER (+ KombiMapping für C1–C4)
// =====================================================
var codeToTier = {
  // S* / R* - Codes, wie gehabt
  S1: "Adler",   S2: "Ameise",   R1: "Yak",     R2: "Katze",
  S3: "Biene",   S4: "Chamäleon",R3: "Parasit", R4: "Wal",
  S5: "Dinosaurier", S6: "Einhorn", R5: "Schakal", R6: "Piranha",
  S7: "Eiche",   S8: "Eule",     R7: "Maus",    R8: "Löwe",
  S9: "Faultier",S10: "Geier",   R11: "Insekt (lästig)", R12: "Insekt (nützlich)",
  S11: "Gibbon", S12: "Hund",    R9: "Klapperschlange", R10: "Kind",
  S13: "Hybrid", S14: "Hyäne",   R15: "Hund",   R16: "Gibbon",
  S15: "Insekt (nützlich)", S16: "Insekt (lästig)", R13: "Hyäne", R14: "Hybrid",
  S17: "Kind",   S18: "Klapperschlange", R19: "Eule", R20: "Eiche",
  S19: "Löwe",   S20: "Maus",    R21: "Einhorn", R22: "Dinosaurier",
  S21: "Piranha",S22: "Schakal", R17: "Geier",  R18: "Faultier",
  S23: "Wal",    S24: "Parasit", R25: "Ameise", R26: "Adler",
  S25: "Katze",  S26: "Yak",     R23: "Chamäleon", R24: "Biene"
};

// Antwortkombinationen in Frage 14 -> mehrere Tiere gleichzeitig
var comboMapping = {
  C1: ["Adler","Ameise","Biene","Chamäleon","Wal","Einhorn"],
  C2: ["Yak","Katze","Parasit","Dinosaurier","Schakal","Piranha"],
  C3: ["Eiche","Eule","Maus","Löwe","Faultier","Geier","Hybrid"],
  C4: ["Insekt (lästig)","Insekt (nützlich)","Klapperschlange","Kind","Hyäne","Hund","Gibbon"]
};

// =====================================================
// 3) TIER-BESCHREIBUNGEN
// =====================================================
var tierTexte = {
  "Adler": "🦅 Fokussiert, Weitblick, Führungsqualitäten",
  "Ameise": "🐜 Fleißig, strukturiert, Organisationstalent",
  "Yak": "🐂 Robust, ausdauernd – Fels in der Brandung",
  "Katze": "🐈 Elegant, unabhängig, anpassungsfähig",
  "Biene": "🐝 Kooperativ, kreativ, gemeinschaftsorientiert",
  "Chamäleon": "🦎 Anpassungsfähig, flexible Lösungen",
  "Parasit": "🪱 Unkonventionell, neue Denkansätze",
  "Wal": "🐋 Ruhepol, vermittelt Stabilität",
  "Dinosaurier": "🦖 Kraftvoll, meistert große Herausforderungen",
  "Einhorn": "🦄 Visionär, idealistisch, inspiriert andere",
  "Schakal": "🦊 Clever, strategisch, nutzt Chancen",
  "Piranha": "🐟 Dynamisch, entschlossen, packt schnell an",
  "Eiche": "🌳 Stabil, bodenständig, weise Entscheidungen",
  "Eule": "🦉 Nachdenklich, analytisch, kluge Einsichten",
  "Maus": "🐁 Vorsichtig, detailorientiert, zuverlässig",
  "Löwe": "🦁 Mutig, übernimmt gerne Verantwortung",
  "Faultier": "🦥 Bedächtig, reflektiert, geht Stress aus dem Weg",
  "Geier": "🦅 (Geier) Vorausschauend, strategisch, ressourcenschonend",
  "Insekt (lästig)": "🐞 Manchmal provokant, stört Komfortzonen",
  "Insekt (nützlich)": "🐞 Effizient, konstruktiv, Teamplayer",
  "Gibbon": "🐒 Kommunikativ, fördert Zusammenhalt",
  "Hund": "🐕 Loyal, vertraut auf Bewährtes",
  "Klapperschlange": "🐍 Schnell, entschlossen, kann zustechen",
  "Kind": "👶 Neugierig, spontan, unvoreingenommen",
  "Hyäne": "🦝 (Hyäne?) Durchsetzungsstark, zielorientiert, flexibel",
  "Hybrid": "🔀 Vielseitig, innovativ, verbindet Verschiedenes"
};
var tierKonflikte = {
  "Adler": {
    "Kind": "Der Adler denkt strategisch und strebt nach Kontrolle – das spontane Kind folgt lieber seiner Neugier.",
    "Faultier": "Adlers Dynamik trifft auf das entschleunigte Tempo des Faultiers – das kann zu Frust führen."
  },
  "Ameise": {
    "Piranha": "Die strukturierte Ameise plant sorgfältig – der Piranha springt ohne zu zögern ins Chaos.",
    "Parasit": "Die arbeitsame Ameise empfindet die provokante Art des Parasiten als störend."
  },
  "Yak": {
    "Kind": "Der stabile Yak braucht Ruhe – das impulsive Kind bringt Unordnung in seine Welt.",
    "Piranha": "Yak geht Aufgaben geduldig an – der Piranha drängt zu sofortigem Handeln."
  },
  "Katze": {
    "Hund": "Die unabhängige Katze will Freiraum – der Hund sucht Nähe und Bindung.",
    "Gibbon": "Katzen schweigen gern – Gibbons kommunizieren ständig. Da prallen Welten aufeinander."
  },
  "Biene": {
    "Klapperschlange": "Die teamorientierte Biene wird von der direkten Art der Klapperschlange oft verletzt.",
    "Dinosaurier": "Die Biene denkt kooperativ – der Dinosaurier agiert machtvoll und ohne Rücksicht."
  },
  "Chamäleon": {
    "Eule": "Das anpassungsfreudige Chamäleon wechselt oft die Richtung – die Eule sucht klare Linien.",
    "Eiche": "Chamäleons Wandelbarkeit irritiert die standfeste Eiche."
  },
  "Parasit": {
    "Wal": "Der Parasit bringt Unruhe – der Wal braucht Harmonie und Tiefe.",
    "Gibbon": "Der Parasit denkt individualistisch – der Gibbon sucht Verbindung und Teamgeist."
  },
  "Wal": {
    "Schakal": "Der Wal möchte inneren Frieden – der Schakal spielt taktisch mit Menschen.",
    "Kind": "Wal liebt Beständigkeit – das Kind bringt Chaos in ruhige Gewässer."
  },
  "Dinosaurier": {
    "Chamäleon": "Der massive Dinosaurier ist unbeweglich – das Chamäleon fließt durch Veränderung.",
    "Einhorn": "Dinosaurier denkt praktisch – das Einhorn träumt von Utopien."
  },
  "Einhorn": {
    "Hyäne": "Das sensible Einhorn sucht Inspiration – die Hyäne handelt kühl und berechnend.",
    "Klapperschlange": "Einhorn will Harmonie – Klapperschlange konfrontiert direkt."
  },
  "Schakal": {
    "Wal": "Der analytische Schakal sieht im Wal einen trägen Blockierer.",
    "Kind": "Der listige Schakal kann mit kindlicher Naivität wenig anfangen."
  },
  "Piranha": {
    "Eule": "Piranha stürzt los – die Eule analysiert zuerst. Diese Tempi passen selten zusammen.",
    "Faultier": "Der Piranha wird vom bedachten Tempo des Faultiers gebremst."
  },
  "Eiche": {
    "Chamäleon": "Die unbeirrbare Eiche versteht das anpassungsfreudige Chamäleon nicht.",
    "Piranha": "Eiche handelt überlegt – Piranha agiert aggressiv. Da knirscht es im Gebälk."
  },
  "Eule": {
    "Kind": "Die nachdenkliche Eule analysiert lange – das Kind springt emotional dazwischen.",
    "Hyäne": "Die Eule liebt Tiefe – die Hyäne liebt Ergebnisse. Beides zusammen geht schwer."
  },
  "Maus": {
    "Löwe": "Die vorsichtige Maus fühlt sich vom durchsetzungsstarken Löwen oft überrollt.",
    "Hyäne": "Die Maus vermeidet Konflikte – die Hyäne geht mitten hinein."
  },
  "Löwe": {
    "Maus": "Der Löwe übernimmt – die Maus zieht sich zurück. Schwer hier ein Gleichgewicht zu finden.",
    "Eule": "Der impulsive Löwe ist der Eule zu schnell und unbedacht."
  },
  "Faultier": {
    "Adler": "Das Faultier sucht innere Ruhe – der Adler will Höhenflüge und Geschwindigkeit.",
    "Piranha": "Faultier fühlt sich vom Energielevel des Piranhas überfordert."
  },
  "Geier": {
    "Kind": "Der strategische Geier denkt langfristig – das Kind lebt im Hier und Jetzt.",
    "Chamäleon": "Der Geier vertraut Planbarkeit – das Chamäleon erscheint ihm sprunghaft."
  },
  "Insekt (lästig)": {
    "Hund": "Das provokante Insekt reizt den loyalen Hund – der sucht nur Frieden.",
    "Kind": "Das Insekt kitzelt an Grenzen – das Kind reagiert emotional und unkontrolliert."
  },
  "Insekt (nützlich)": {
    "Parasit": "Das nützliche Insekt handelt strukturiert – der Parasit bringt gezielte Unordnung.",
    "Klapperschlange": "Das Team-Insekt will Kooperation – die Schlange setzt lieber eigene Wege durch."
  },
  "Gibbon": {
    "Yak": "Der kommunikative Gibbon trifft auf die schweigsame Ruhe des Yaks.",
    "Parasit": "Gibbons offene Art eckt beim grenztestenden Parasit an."
  },
  "Hund": {
    "Katze": "Der anhängliche Hund sucht Bestätigung – die Katze schätzt Unabhängigkeit.",
    "Parasit": "Hund steht für Treue – Parasit für Regelbruch. Das sorgt für Reibung."
  },
  "Klapperschlange": {
    "Wal": "Die konfrontative Klapperschlange bringt den ruhigen Wal aus dem Gleichgewicht.",
    "Kind": "Die entschlossene Schlange trifft auf kindliche Spontanität – das endet selten harmonisch."
  },
  "Kind": {
    "Adler": "Das Kind lebt frei – der Adler verlangt Struktur. Das sorgt für Konflikte.",
    "Geier": "Kind will erleben – Geier will verstehen. Beide reden oft aneinander vorbei."
  },
  "Hyäne": {
    "Einhorn": "Die durchsetzungsstarke Hyäne agiert zielgerichtet – das Einhorn träumt sich in andere Welten.",
    "Biene": "Hyäne geht ihren Weg – die Biene sucht Gemeinschaft. Da fehlt oft das Verständnis."
  },
  "Hybrid": {
    "Ameise": "Der kreative Hybrid wechselt Perspektiven – die Ameise wünscht sich Planbarkeit.",
    "Yak": "Der innovative Hybrid will Veränderung – der Yak steht lieber fest auf vertrautem Boden."
  }
};
// =====================================================
// 4) SKALA (0–4) – Nur Zahlen
// =====================================================
var skalenWerte = [
  { value: 0, label: "0" },
  { value: 1, label: "1" },
  { value: 2, label: "2" },
  { value: 3, label: "3" },
  { value: 4, label: "4" }
];

// =====================================================
// 5) FORMULAR GENERIEREN
// =====================================================
var formElem = document.getElementById("fragebogen");
for (var i = 0; i < questions.length; i++) {
  var q = questions[i];
  var box = document.createElement("div");
  box.className = "frage-box";
  box.innerHTML = "<h2>" + q.frage + "</h2>";

  var answerKeys = Object.keys(q.answers);
  for (var j = 0; j < answerKeys.length; j++) {
    var letter = answerKeys[j];
    var ans = q.answers[letter];

    var ansDiv = document.createElement("div");
    ansDiv.className = "skala-antwort";

    var radiosHTML = "";
    for (var k = 0; k < skalenWerte.length; k++) {
      radiosHTML +=
        '<label>' +
          '<input type="radio" ' +
            'name="frage' + i + '_' + ans.code + '" ' +
            'value="' + skalenWerte[k].value + '" ' +
            'required>' +
          skalenWerte[k].label +
        '</label>';
    }

    ansDiv.innerHTML =
      "<p><strong>" + letter + ":</strong> " + ans.text + "</p>" +
      radiosHTML;
    box.appendChild(ansDiv);
  }
  formElem.appendChild(box);
}

// =====================================================
// 6) AUSWERTUNG
// =====================================================
formElem.addEventListener("submit", function(evt){
  evt.preventDefault();
  var formData = new FormData(formElem);
  var tierCounts = {};

  // Zähle alle Tierpunkte
  for (var i = 0; i < questions.length; i++) {
    var q = questions[i];
    var answerKeys = Object.keys(q.answers);

    for (var j = 0; j < answerKeys.length; j++) {
      var letter = answerKeys[j];
      var ans = q.answers[letter];
      var fieldName = "frage" + i + "_" + ans.code;
      var valStr = formData.get(fieldName);
      var valNum = parseInt(valStr, 10) || 0;

      if (comboMapping[ans.code]) {
        var tierList = comboMapping[ans.code];
var anteil = valNum / tierList.length;
tierList.forEach(function(tier){
  tierCounts[tier] = (tierCounts[tier] || 0) + anteil;
});

      } else {
        var singleTier = codeToTier[ans.code];
        tierCounts[singleTier] = (tierCounts[singleTier] || 0) + valNum;
      }
    }
  }

  // Gesamtsumme für Prozentberechnung
  var totalPoints = Object.values(tierCounts).reduce((sum, val) => sum + val, 0);

  // Sortierung nach Punkten
  var sortedTiers = Object.entries(tierCounts).sort((a, b) => b[1] - a[1]);
  var top5 = sortedTiers.slice(0, 5);
  var hauptprofile = top5.slice(0, 3);
  var nebenprofile = top5.slice(3, 5);

  var ergebnisElem = document.getElementById("ergebnis");
  ergebnisElem.innerHTML = "<h2>Dein Verhaltens-Mix</h2>";

  function renderTierBlock(title, tierList, top5Total) {
    var section = document.createElement("div");
    section.innerHTML = "<h3>" + title + "</h3>";
    tierList.forEach(function([tierName, value], idx) {
     var prozent = ((value / top5Total) * 100).toFixed(1);
      var tierDiv = document.createElement("div");
      tierDiv.className = "tier-block";
      var canvasId = "tierChart_" + tierName.replace(/\s+/g, "_");

      tierDiv.innerHTML = `
        <strong>${tierName}</strong> – ${tierTexte[tierName] || ""}
        <br><em>${prozent}% innerhalb deiner Top 5</em>
        <canvas id="${canvasId}" width="300" height="150"></canvas>
      `;

      section.appendChild(tierDiv);

      setTimeout(() => {
        new Chart(document.getElementById(canvasId).getContext("2d"), {
          type: 'doughnut',
          data: {
            labels: [tierName, "Andere"],
            datasets: [{
              data: [value, top5Total - value],
              backgroundColor: ["#3498db", "#ecf0f1"]
            }]
          },
          options: {
            responsive: false,
            plugins: {
              legend: { display: false },
              title: { display: false }
            },
            cutout: "70%"
          }
        });
      }, 10);
    });
    ergebnisElem.appendChild(section);
  }

  var top5Total = top5.reduce((sum, el) => sum + el[1], 0);
renderTierBlock("🧭 Hauptprofile (Top 3)", hauptprofile, top5Total);
renderTierBlock("🧩 Nebenprofile (Platz 4 & 5)", nebenprofile, top5Total);

  // Erklärung am Ende
  var erklaerung = document.createElement("div");
  erklaerung.className = "ergebnis-erklaerung";
  erklaerung.innerHTML = `
    Diese Übersicht zeigt deinen momentanen Verhaltens-Mix anhand von Tiermetaphern.
    Die <strong>Hauptprofile</strong> spiegeln dominante Eigenschaften wider,
    die <strong>Nebenprofile</strong> ergänzen sie durch weitere Facetten.
    Die Prozentzahlen basieren auf allen Antworten und visualisieren dein aktuelles Gesamtbild.
  `;




  ergebnisElem.appendChild(erklaerung);
var konfliktDiv = document.createElement("div");
konfliktDiv.className = "ergebnis-erklaerung";
konfliktDiv.style.marginTop = "20px";
konfliktDiv.innerHTML = "<h3>⚡ Potenzielle Spannungsfelder</h3><ul>";

hauptprofile.forEach(function([tierName]) {
  var konflikte = tierKonflikte[tierName];
  if (konflikte) {
    Object.entries(konflikte).forEach(([gegner, beschreibung]) => {
      konfliktDiv.innerHTML += `
        <li><strong>${tierName}</strong> steht potenziell im Widerspruch zu <em>${gegner}</em>: ${beschreibung}</li>
      `;
    });
  }
});

konfliktDiv.innerHTML += "</ul>";
ergebnisElem.appendChild(konfliktDiv);

  // Reflektionstext ergänzen
  var reflekt = document.createElement("div");
  reflekt.className = "ergebnis-erklaerung";
  reflekt.style.marginTop = "20px";
  reflekt.innerHTML = `
    <h3>🔍 Wie du dein Ergebnis verstehen kannst</h3>
    <p>
      Die dargestellten Tiermetaphern symbolisieren verschiedene Seiten deines Verhaltens – 
      keine davon ist "besser" oder "richtiger" als die andere.
    </p>
    <p>
      Dein Mix zeigt, welche Stärken bei dir aktuell im Vordergrund stehen. 
      Vielleicht erkennst du dich in einem mutigen <strong>Löwen</strong>, einer strukturierten <strong>Ameise</strong> 
      oder einem anpassungsfähigen <strong>Chamäleon</strong> wieder.
    </p>
    <p>
      Je nach Lebensphase, Rolle oder Herausforderung können sich diese Anteile verändern. 
      Ein starker „Adler“-Anteil zeigt etwa Fokus und Überblick, 
      während ein hoher „Wal“-Wert auf innere Ruhe und Stabilität hinweist.
    </p>
    <p>
      Dein Verhaltens-Mix ist kein endgültiges Urteil, sondern eine Momentaufnahme – 
      und zugleich eine Einladung zur Selbstreflexion:
      <em>Was erkennst du wieder? Was willst du weiterentwickeln?</em>
    </p>
    <p><strong>Nutze dein Tierprofil nicht als Schublade – sondern als Spiegel.</strong></p>
  `;
  ergebnisElem.appendChild(reflekt);
});
</script>

</body>
</html>
